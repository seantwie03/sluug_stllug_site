---
import type { MeetingType } from "@/content/config";

type Props = {
    meetingType: MeetingType;
    meetingDate: Date;
};

const { meetingType, meetingDate } = Astro.props;
---

<meeting-materials data-meetingtype={meetingType} data-meetingdate={meetingDate}>
    <div id="meeting-materials">
        <h2>Meeting Materials</h2>
    </div>
</meeting-materials>

<script>
    import { getIsoDate } from "@/buildTimeUtils";
    import { SLUUG_SITE_URL } from "@/constants";

    class MeetingMaterials extends HTMLElement {
        constructor() {
            super();
            const meetingDate = new Date(this.dataset.meetingdate!);
            const meetingType = this.dataset.meetingtype! as "SLUUG" | "STLLUG";
            const meetingMaterials = document.getElementById("meeting-materials")!;
            // TODO: Error due to CORS
            fetch(
                `${SLUUG_SITE_URL}/resources/presentations/media/${meetingDate.getFullYear()}/${meetingType === "SLUUG" ? "Main" : "STLLINUX"}/${getIsoDate(meetingDate)}.json`
            )
                .then((response) => console.log(response.json()))
                .catch(() => {
                    meetingMaterials.style.display = "none";
                });
        }
    }
    customElements.define("meeting-materials", MeetingMaterials);
</script>
